generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["identity"]
}

enum Role {
  ADMIN
  STAFF
  CUSTOMER

  @@schema("identity")
}


model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  fullName     String?
  isActive     Boolean  @default(true)
  restaurantId String? 
  phoneNumber  String?  @unique


  roles         UserRole[]
  refreshTokens RefreshToken[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@schema("identity")
}

model UserRole {
  id     String @id @default(cuid())
  role   Role
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, role])
  @@schema("identity")
}

model RefreshToken {
  id         String   @id @default(cuid())
  tokenHash  String
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  revokedAt  DateTime?
  expiresAt  DateTime
  createdAt  DateTime @default(now())

  @@index([userId])
  @@schema("identity")
}
